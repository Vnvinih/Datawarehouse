SELECT e.nome_empresa, YEAR(ms.data_hora_entrada) AS ano, COUNT(DISTINCT c.id_cliente) AS numero_de_funcionarios
FROM tb_empresa e
JOIN tb_beneficio b ON e.codigo_empresa = b.codigo_empresa
JOIN tb_cliente c ON b.codigo_funcionario = c.id_cliente
JOIN tb_mesa ms ON c.id_cliente = ms.id_cliente
JOIN tb_pedido pd ON ms.codigo_mesa = pd.codigo_mesa
JOIN tb_prato p ON pd.codigo_prato = p.codigo_prato
JOIN tb_tipo_prato tp ON p.codigo_tipo_prato = tp.codigo_tipo_prato
WHERE tp.nome_tipo_prato = 'Sobremesa'
GROUP BY e.nome_empresa, YEAR(ms.data_hora_entrada)
ORDER BY COUNT(DISTINCT c.id_cliente) DESC
LIMIT 1
